<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" 
          href="bootstrap-3.3.5-dist/css/bootstrap.css">
    <style>
        #middleLine{
            border-left: 1px solid black;
            height: 100%;
        }
        #topic1{
            background-color:rgba(0,0,0,0.7);
        }
        #topic2{
            background-color:rgba(0,0,0,0.7);
        }
        body{
            background-size: cover;
        }
        #contain{
            padding-top: 3%;
        }

        #left_side{
            background-color:rgba(0,0,0,0.3);
            border:none;
        }
        #right_side{
            background-color:rgba(0,0,0,0.3);
            border:none;
        }
        #percentWater2{
            padding-top: 9%;
        }
        #heading{
            font-size: 80pt;
            text-shadow: 2px 2px #000000;
        }
        .loader {
            width: 120px;
            height: 120px;
            background: #ffffff;
            border: 10px solid #0d283b;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
        }

        .counter {
            width: 100%;
            line-height: 100px;
            font-size: 24px;
            font-weight: bold;
            color: #000000;
            text-align: center;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0.5;
        }
        #password1{
            padding-top: 5%;
            font-size: 15pt;
        }#password2{
            padding-top: 5%;
            font-size: 15pt;
        }
        #labelPass1{
            font-size: 15pt;
            color: floralwhite;
        }
        #open1{
            font-size: 15pt;
        }
        #close1{
            font-size: 15pt;
        }
        #open2{
            font-size: 15pt;
        }
        #close2{
            font-size: 15pt;
        }
    </style>
</head>
<body background="wallpaper/dam.jpg">
<!--<div class="row" id="heading"><center><font Color="white">Smart Dam</font></center></div>-->
<div class = "container" id="contain" style="font-family: Sukhumvit Set" >
      <div class="row" id="heading"><center><font Color="white">Smart Dam</font></center></div>
      <div><br></div>
   
   <!-- Start of left side -->
   
    <div class="col-lg-5 panel panel-default" id="left_side" style="border-color: azure;">
        <div class="row panel-heading" id="topic1" style="font-size: 90pt; border:none;" ><center><font color="white">Dam 1</font></center></div>
            
        <div class="panel-body" id="main1">
<!--        <div><br></div>-->
        <div class="row" style="font-size: 35pt; color:white; -webkit-text-stroke: 1px white; text-shadow: 2px 2px #000000;"><center>Water Level</center></div>
        <div class="row"><br></div>
        <div class="row">
           <div class="col-lg-1"></div>
           <div class="col-lg-4">
            <!-- <div class="progress" style="height:40px">
                <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="width: 50%; line-height:350%;" id="levelWater1">
                <font id="percentWater1" size="5pt">50%</font>
                </div>
            </div> -->
            <div class="loader" id="levelWater1" ></div>
            <div class="row"><br></div>
            </div>
            <div class="col-lg-6">
                <div class="row">
                    <input type="password" class="form-control" id="password1" placeholder="Password">
                </div>
                <div class="row"><br></div>
                <div class="row">
                    <button type="button" class="btn btn-success" id="open1"><center>Open</center></button>
                    <div class="col-lg-1"></div>
                    <button type="button" class="btn btn-danger" id="close1"><center>Close</center></button>
                </div>
                </div>
        </div>
        <div class="row"><br></div>
        <div class="row">
           <div class="col-lg-12">
            <div class="panel panel-default" id="statusPane1" style="background-color:rgba(255,255,255,0.8);">
                <div class="panel-body">
                        <div class="row" id="status1" style="font-size: 35pt; text-align: center"><center>Status</center></div>
                        <div class="row" id="reason1" style="font-size: 26pt; text-align: center"><center>reason</center></div>
                </div>
               
           </div>
        </div>
        </div>
    </div>
    </div>
    
    <!-- End of left side -->
    
    <div class="col-lg-2" id="middleLine" ></div>
    
    <!-- Start of right side -->
    <div class="col-lg-5 panel panel-default" id="right_side" style="border-color: azure;">
        <div class="row panel-heading" id="topic2" style="font-size: 90pt; border:none;"><center><font color="white">Dam 2</font></center></div>
        <div class="panel-body" id="main2">    
<!--            <div class="row"><br></div>-->
        <div class="row" style="font-size: 35pt; color:white; -webkit-text-stroke: 1px white; text-shadow: 2px 2px #000000;"><center>Water Level</center></div>
        <div class="row"><br></div>
        <div class="row">
           <div class="col-lg-1"></div>
           <div class="col-lg-4">
            <!-- <div class="progress" style="height:40px">
                <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="width: 50%; line-height:350%;" id="levelWater1">
                <font id="percentWater1" size="5pt">50%</font>
                </div>
            </div> -->
            <div class="loader" id="levelWater2" ></div>
            <div class="row"><br></div>
            </div>
            <div class="col-lg-6">
               <div class="row"><input type="password" class="form-control" id="password2" placeholder="Password"></div>
               <div class="row"><br></div>
                <div class="row">
                    <button type="button" class="btn btn-success" id="open2"><center>Open</center></button>
                    <div class="col-lg-1"></div>
                    <button type="button" class="btn btn-danger" id="close2"><center>Close</center></button>
                </div>
                </div>
        </div>
        <div class="row"><br></div>
        <div class="row">
           <div class="col-lg-1"></div>
           <div class="col-lg-12">
            <div class="panel panel-default" id="statusPane2" style="background-color:rgba(255,255,255,0.8);">
                <div class="panel-body">
                        <div class="row" id="status2" style="font-size: 35pt; text-align: center"><center>Status</center></div>
                        <div class="row" id="reason2" style="font-size: 26pt; text-align: center"><center>reason</center></div>
                </div>
               
           </div>
        </div>
        </div>
    </div>
    </div>
    
    <!-- End of right side -->
    
</div>


        <script src="./jquery.js"></script>
        <script src="js/loader.js"></script>
        <script>
            $.ajaxSetup({
                async: false
            });

            $("#levelWater1").loader('setProgress', 0);
            $("#levelWater1").loader('setProgress', 50);
            $("#levelWater2").loader('setProgress', 0);
            $("#levelWater2").loader('setProgress', 50);
            var water_1_now = 50;
            var water_2_now = 50;
            var reasons = {
                "0": "Reason: low water level",
                "1": "Reason: medium water level",
                "2": "Reason: high water level",
                "3": "Reason: another get low water level",
                "4": "Reason: commanded"
            };
            var state = {
                "0": "Closed",
                "1": "Opened"
            };
            var water1;
            var water2;
            var state;
            var input1;
            var input2;
            var text;
            var password_1 = "hello";
            var password_2 = "world";
            $.get("http://exceed.cupco.de/iot/systemma/password1", function(m){
                password_1 = m;
            });
            $.get("http://exceed.cupco.de/iot/systemma/password2", function(m){
                password_2 = m;
            });
        
            function getLevelWater(){
                $.get("http://exceed.cupco.de/iot/systemma/board1", function(m){
                    input1 = m;
                    // alert(input1);
                });
                $.get("http://exceed.cupco.de/iot/systemma/board2", function(m){
                    input2 = m;
                });

                console.log("Input 1: " + input1);
                console.log("Input 2: " + input2);

                if(input1 == undefined){
                    return ;
                }
                if(parseInt(input1.substring(3, input1.length)) < 0){
                    water1 = 0;
                    console.log(parseInt(input1.substring(3, input1.length)));
                }
                else if(parseInt(input1.substring(3, input1.length)) > 100){
                    water1 = 100;
                    console.log(parseInt(input1.substring(3, input1.length)));
                }
                else
                    water1 = parseInt(input1.substring(3, input1.length));

                if(input2 == undefined){
                    return ;
                }
                if(parseInt(input2.substring(3, input2.length)) < 0){
                    water2 = 0;
                    console.log(parseInt(input2.substring(3, input2.length)));
                }
                else if(parseInt(input2.substring(3, input2.length)) > 100){
                    water2 = 100;
                    console.log(parseInt(input2.substring(3, input2.length)));
                }
                else
                    water2 = parseInt(input2.substring(3, input2.length));

                console.log("Water1: " + water1);
                console.log("Water2: " + water2);

                $("#status1").text("Status: " + state[input1.substring(1,2)]);
                $("#status2").text("Status: " + state[input2.substring(1,2)]);


                $("#reason1").text(reasons[input1.substring(2,3)]);
                $("#reason2").text(reasons[input2.substring(2,3)]);

                if($("#reason1").text() == "Reason: commanded"){
                    $.post("http://exceed.cupco.de/iot/systemma/web", {data: "0"});
                }

                if($("#reason2").text() == "Reason: commanded"){
                    $.post("http://exceed.cupco.de/iot/systemma/web", {data: "0"});
                }

       
                if(water_1_now < water1){
                    $("#levelWater1").loader("setProgress", ++water_1_now);
                }else if(water_1_now > water1){
                    $("#levelWater1").loader("setProgress", --water_1_now);

                }

                if(water_2_now < water2){
                    $("#levelWater2").loader("setProgress", ++water_2_now);
                }else if(water_2_now > water2){
                    $("#levelWater2").loader("setProgress", --water_2_now);
                }

            }

            $("#open1").click(function(){
                sendOpen1();
            });

            $("#open2").click(function(){
                sendOpen2();
            });

            $("#close1").click(function(){
                sendClose1();
            });

            $("#close2").click(function(){
                sendClose2();
            });


            function sendOpen1(){
                if($("#password1").val() == password_1){
                    $("#password1").val('');
                    if(input1.substring(0, 1) == "0"){
                        alert("Can't be opened because we've got low water level");
                        return ;
                    }
                    $.post("http://exceed.cupco.de/iot/systemma/web", {data: "O1"});
                    alert("Dam 1 opened!");
                    // $("#open1").prop("disabled", true);
                    // $("#close1").prop("disabled", false);
                }
                else{
                    $("#password1").val('');
                    alert("Wrong Password!");
                }
            }

            function sendOpen2(){
                if($("#password2").val() == password_2){
                    $("#password2").val('');
                    if(input2.substring(0, 1) == "0"){
                        alert("Can't be opened because we've got low water level");
                        return ;
                    }
                    $("#password2").val('');
                    $.post("http://exceed.cupco.de/iot/systemma/web", {data: "O2"});
                    alert("Dam 2 opened!");
                    // $("#open2").prop("disabled", true);
                    // $("#close2").prop("disabled", false);
                }
                else{
                    $("#password2").val('');
                    alert("Wrong Password!");
                }
            }

            function sendClose1(){
                if($("#password1").val() == password_1){
                    $("#password1").val('');
                    if(input1.substring(0, 1)== "2"){
                        alert("Can't be closed because we've high level water");
                        return ;
                    }
                    $.post("http://exceed.cupco.de/iot/systemma/web", {data: "C1"});
                    alert("Dam 1 close!");
                    // $("#open1").prop("disabled", false);
                    // $("#close1").prop("disabled", true);
                }
                else{
                    $("#password1").val('');
                    alert("Wrong Password!");
                }
            }

            function sendClose2(){
                if($("#password2").val() == password_2){
                    $("#password2").val('');
                    if(input2.substring(0, 1) == "2"){
                        alert("Can't be closed because we've high level water");
                        return ;
                    }
                    $.post("http://exceed.cupco.de/iot/systemma/web", {data: "C2"});
                    alert("Dam 2 close!");
                    // $("#open2").prop("disabled", false);
                    // $("#close2").prop("disabled", true);
                }
                else{
                    $("#password2").val('');
                    alert("Wrong Password!");
                }
            }

            setInterval(getLevelWater, 100);
        </script>
</body>
</html>